\chapter{1階述語論理の証明論}
\label[chapter]{chap:proof}

この章では，いよいよ「証明」という概念の形式化を試みる．
\Cref{chap:syntax}で定義された論理式は，数学における何らかの主張の
形式的記号列の世界での対応物であった．
数学における「証明」は，
形式的記号列の世界においてはある論理式から別の論理式を得る操作に対応する．
どのような操作を妥当なものとして認め，それをどのような記法で書き下すかによって
多種多様な体系が得られる．本書では，その中から自然演繹式シークエント計算と呼ばれる体系を取り上げる．

\newpage


\section{シークエント} \label[section]{sec:sequent}

自然演繹式シークエント計算において基本的なのは，シークエントと呼ばれる記号列である．

\begin{Def} \label[Def]{Def:sequent}
	0個以上の論理式の有限列\(\Gamma\)と論理式\(\varphi\)に対して，記号列%
	\index[sidx]{\(\Gamma \sequent \varphi\)：シークエント}%
	\begin{equation}
		\Gamma \sequent \varphi
	\end{equation}
	を%
	\index[widx]{しーくえんと@シークエント}%
	\term{シークエント}という．
	このとき，\(\Gamma\)をこのシークエントの左辺，\(\varphi\)をこのシークエントの右辺という．
\end{Def}

\begin{Ex} \label[Ex]{Ex:sequent}
	論理式\(\varphi\)に対して，
	\begin{equation*}
		\varphi \sequent \varphi
	\end{equation*}
	という記号列はシークエントである．この形のシークエントを%
	\index[widx]{ししき@始式}%
	\term{始式}と呼ぶ．
	また，左辺に何もない
	\begin{equation*}
		\sequent \varphi, \\
	\end{equation*}
	といった記号列もシークエントである．
\end{Ex}

シークエント「\(\Gamma \sequent \varphi\)」は，
通常の数学における「\(\Gamma\)という仮定によって\(\varphi\)を証明することができる」という
主張の形式的記号列の世界での対応物であることを期待して導入されたものである．
左辺に何もないシークエント「\(\sequent \varphi\)」は，
何も仮定せずとも\(\varphi\)が証明できること，すなわち「\(\varphi\)は証明できる」ことの
形式的記号列の世界での対応物であることが期待される．
以下で行われるのは，このシークエントを操作していくルールをうまく定義して
「証明っぽいもの」を作り上げていくことである．


\section{公理と推論規則} \label[section]{sec:axiomandrule}

通常の数学においては，議論の出発点となる主張，すなわち公理を用意し，
そこから演繹的推論を重ねていくことによってさまざまな結果を得る．
自然演繹式シークエント計算においては，
出発点となるシークエントから特定の操作を行うことによって
さまざまな結果を得ることになる．
このとき，出発点となるシークエントのことを%
\index[widx]{こうり@公理}%
\term{公理}と呼ぶ%
\footnote{%
	ここでいう「公理」は自然演繹式シークエント計算という証明体系そのものの出発点となるシークエントであり，
	個々の理論の基礎となる主張のことではない．通常の数学における「公理」に対応するのは
	閉論理式の集合である．
}%
．
また，
あるシークエントから別のシークエントを得る操作をいくつか列挙し，
それを使って議論を進めていく．
この時に列挙した操作のことを%
\index[widx]{すいろんきそく@推論規則}%
\term{推論規則}
と呼ぶ．
以下に自然演繹式シークエント計算で用いる公理と推論規則の一覧を述べる．

公理や推論規則は，シークエントを横や縦に並べた
\begin{prooftree}
	\AxiomC{\(\Gamma \sequent \varphi \)}
	\AxiomC{\(\Delta \sequent \psi\)}
	\LeftLabel{(name)}
	\BinaryInfC{\(\Sigma \sequent \xi\)}
\end{prooftree}
のような形式で記述される．「(name)」は規則名である．
この記述は「上側に記述されているシークエントがすべて得られたら下段のシークエントを得てよい」
という意味ととらえてよい．
上段に何も書かれていない場合もあり，それが公理である．

\begin{Def}[公理] \label[Def]{Def:axiom}
	論理式\(\varphi\)に対して，以下は自然演繹式シークエント計算における公理である：
	\begin{prooftree}
		\AxiomC{}
		\LeftLabel{(ID)}
		\UnaryInfC{\(\varphi \sequent \varphi\)}
	\end{prooftree}
\end{Def}

推論規則名になっている「ID」は同一律（law of identity）に由来する．

推論規則の数はそれなりに多いので，いくつかのグループに分けて述べる．
なお，\cref{Def:structuralrule}における推論規則名「w」「e」「c」はそれぞれ
弱化（weakening），交換（exchange），縮約（contraction）に由来する．

\begin{Def}[構造規則] \label[Def]{Def:structuralrule}
	論理式の有限列\(\Gamma, \Delta\)と論理式\(\varphi, \psi, \xi\)に対し，
	下記の3つは自然演繹式シークエント計算における推論規則である．
	\begin{multicols}{3}
		\begin{prooftree}
			\AxiomC{\(\Gamma \sequent \xi\)}
			\LeftLabel{(w)}
			\UnaryInfC{\(\varphi, \Gamma \sequent \xi\)}
		\end{prooftree}
		\columnbreak
		\begin{prooftree}
			\AxiomC{\(\Gamma, \psi, \varphi, \Delta \sequent \xi\)}
			\LeftLabel{(e)}
			\UnaryInfC{\(\Gamma, \varphi, \psi \sequent \xi\)}
		\end{prooftree}
		\columnbreak
		\begin{prooftree}
			\AxiomC{\(\varphi, \varphi, \Gamma \sequent \xi\)}
			\LeftLabel{(c)}
			\UnaryInfC{\(\varphi, \Gamma \sequent \xi\)}
		\end{prooftree}
	\end{multicols}
\end{Def}

論理記号に関する推論規則を述べる．
推論規則名の「I」や「E」はそれぞれ
導入（Introduction）と除去（Elimination）に由来する．
例えば，「\(\land\)I」は右辺に\(\land\)記号を新しく導入する推論規則であり，
「\(\land\)E」は右辺から\(\land\)記号を除去するような推論規則である．
すべての推論規則が導入と除去の対になっていることに着目しよう．
我々の素朴的直観において導入規則と除去規則はそれぞれ
「その論理記号を含む論理式に対応する主張を結論として得るためのルール」
「その論理記号を含む論理式に対応する主張が得られた場合に行える推論を表すルール」
に対応する．


\begin{Def}[論理規則その1] \label[Def]{Def:logicalrule1}
	論理式の有限列\(\Gamma, \Delta, \Sigma\)と論理式\(\varphi, \psi, \xi\)に対して，
	下記は自然演繹式シークエント計算における推論規則である．
	\begin{multicols}{2}
		\begin{prooftree}
			\AxiomC{\(\varphi, \Gamma \sequent \psi\)}
			\LeftLabel{(\(\to\)I)}
			\UnaryInfC{\(\Gamma \sequent \varphi \to \psi\)}
		\end{prooftree}
		\columnbreak
		\begin{prooftree}
			\AxiomC{\(\Gamma \sequent \varphi\)}
			\AxiomC{\(\Delta \sequent \varphi \to \psi\)}
			\LeftLabel{(\(\to\)E)}
			\BinaryInfC{\(\Gamma, \Delta \sequent \psi\)}
		\end{prooftree}
	\end{multicols}
	\begin{multicols}{2}
		\begin{prooftree}
			\AxiomC{\(\Gamma \sequent \varphi\)}
			\AxiomC{\(\Delta \sequent \psi\)}
			\LeftLabel{(\(\land\)I)}
			\BinaryInfC{\(\Gamma, \Delta \sequent \varphi \land \psi\)}
		\end{prooftree}
		\columnbreak
		\begin{prooftree}
			\AxiomC{\(\Gamma \sequent \varphi_1 \land \varphi_2\)}
			\LeftLabel{(\(\land\)E)}
			\RightLabel{(\(i \equiv 1,2\))}
			\UnaryInfC{\(\Gamma \sequent \varphi_i\)}
		\end{prooftree}
	\end{multicols}
	\begin{prooftree}
		\AxiomC{\(\Gamma \sequent \varphi_i\)}
		\LeftLabel{(\(\lor\)I)}
		\RightLabel{(\(i \equiv 1,2\))}
		\UnaryInfC{\(\Gamma \sequent \varphi_1 \lor \varphi_2\)}
	\end{prooftree}
	\begin{prooftree}
		\AxiomC{\(\Gamma \sequent \varphi \lor \psi\)}
		\AxiomC{\(\varphi, \Delta \sequent \xi\)}
		\AxiomC{\(\psi, \Sigma \sequent \xi\)}
		\LeftLabel{(\(\lor\)E)}
		\TrinaryInfC{\(\Gamma, \Delta, \Sigma \sequent \xi\)}
	\end{prooftree}
\end{Def}

\begin{Def}[論理規則その2] \label[Def]{Def:quantiferrule}
	論理式の有限列\(\Gamma, \Delta\)と論理式\(\varphi, \psi\)および変数記号\(x, a\)に対して，
	下記の4つは自然演繹式シークエント計算における推論規則である．
	ここで，\(a\)は\(\varphi\)中の\(x\)に代入可能であるものとする．
	\begin{multicols}{2}
		\begin{prooftree}
			\AxiomC{\(\Gamma \sequent \subst{\varphi}{a/x}\)}
			\LeftLabel{(\(\forall\)I)}
			\UnaryInfC{\(\Gamma \sequent \forall x \varphi\)}
		\end{prooftree}
		ただし，\(a\)は\(\Gamma\)中の各論理式や\(\varphi\)に自由出現しない．
		\columnbreak
		\begin{prooftree}
			\AxiomC{\(\Gamma \sequent \forall x \varphi\)}
			\LeftLabel{(\(\forall\)E)}
			\UnaryInfC{\(\Gamma \sequent \subst{\varphi}{a/x}\)}
		\end{prooftree}
	\end{multicols}
	\begin{multicols}{2}
		\begin{prooftree}
			\AxiomC{\(\Gamma \sequent \subst{\varphi}{a}{x}\)}
			\LeftLabel{(\(\exists\)I)}
			\UnaryInfC{\(\Gamma \sequent \exists x \varphi\)}
		\end{prooftree}
		\columnbreak
		\begin{prooftree}
			\AxiomC{\(\Gamma \sequent \exists x \varphi\)}
			\AxiomC{\(\subst{\varphi}{a/x}, \Delta \sequent \psi\)}
			\LeftLabel{(\(\exists\)E)}
			\BinaryInfC{\(\Gamma, \Delta \sequent \psi\)}
		\end{prooftree}
		ただし，\(a\)は\(\Gamma, \Delta\)中の各論理式と\(\exists x \varphi, \psi\)のいずれにも自由出現しない．
	\end{multicols}
\end{Def}

\begin{Def}[論理規則その3] \label{Def:lnot}
	論理式の有限列\(\Gamma\)と論理式\(\varphi\)について，
	下記は自然演繹式シークエント計算における推論規則である．
	\begin{multicols}{2}
		\begin{prooftree}
			\AxiomC{\(\varphi, \Gamma \sequent \bot\)}
			\LeftLabel{(\(\lnot\)I)}
			\UnaryInfC{\(\Gamma \sequent \lnot \varphi\)}
		\end{prooftree}
		\columnbreak
		\begin{prooftree}
			\AxiomC{\(\Gamma \sequent \varphi\)}
			\AxiomC{\(\Gamma \sequent \lnot \varphi\)}
			\LeftLabel{(\(\lnot\)E)}
			\BinaryInfC{\(\Gamma \sequent \bot\)}
		\end{prooftree}
	\end{multicols}
\end{Def}

最後に，いわゆる背理法の基礎となる推論規則を導入しておく．
規則名「DNE」は2重否定除去（Double Negation Elimination）に由来する．

\begin{Def}[2重否定除去] \label[type]{Def:DNE}
	論理式の有限列\(\Gamma\)と論理式\(\varphi\)に対し，
	下記は自然演繹式シークエント計算における推論規則である．
	\begin{prooftree}
		\AxiomC{\(\Gamma \sequent \lnot \lnot \varphi\)}
		\LeftLabel{(DNE)}
		\UnaryInfC{\(\Gamma \sequent \varphi\)}
	\end{prooftree}
\end{Def}

以上で公理と推論規則の準備が整った．あとは「証明」っぽく見えるようにいくつか定義を行うだけである．

\begin{Def} \label[Def]{Def:provable}
	シークエントが%
	\index[widx]{どうしゅつかのう@（シークエントが）導出可能}%
	導出可能であることを，以下のように定義する：
	\begin{enumerate}
		\item 任意の論理式\(\varphi\)に対し，始式\(\varphi \sequent \varphi\)は導出可能である．
		\item これまでに挙げた各推論規則における上段のシークエントがすべて導出可能であるならば，下段のシークエントも導出可能である．
		\item 以上の規則を有限回適用して得られるシークエントのみが導出可能である．
	\end{enumerate}
\end{Def}

あるシークエントが導出可能であることを
確かめる作業のことをそのシークエントの「導出」と呼ぶことがある．
「シークエント\(\Gamma \sequent \varphi\)を導出する」といった言い回しである．

さて，シークエントの導出可能性の次は論理式の証明可能性である．

\begin{Def} \label[Def]{Def:logicalexpressionprovable}
	\(\varphi\)を論理式とする．シークエント
	\begin{equation}
		\sequent \varphi
	\end{equation}
	が導出可能であるとき，\(\varphi\)は%
	\index[widx]{しょうめいかのう@（論理式が）証明可能}%
	\term{証明可能}であるという．
\end{Def}


ここで定義した体系が我々の素朴的直観における「証明」を模倣できているかどうかは，
ここから導かれるさまざまな結果を見るよりほかはない．
例を見てみよう．

\begin{Thm}[背理法] \label[Thm]{Thm:RAA}
	\(\Gamma\)を論理式の有限列，\(\varphi\)を論理式とするとき，
	シークエント
	\(\lnot \varphi, \Gamma \sequent \bot\)
	が導出可能であるならば，シークエント
	\(\Gamma \sequent \varphi\)
	は導出可能である．
\end{Thm}

\begin{proof}
	シークエント\(\Gamma \sequent \varphi\)は次のように得られる．
	\begin{prooftree}
		\AxiomC{\(\lnot \varphi, \Gamma \sequent \bot \)}
		\LeftLabel{(\(\lnot\)I)}
		\UnaryInfC{\(\Gamma \sequent \lnot \lnot \varphi\)}
		\LeftLabel{(DNF)}
		\UnaryInfC{\(\Gamma \sequent \varphi\)}
	\end{prooftree}
	よって，シークエント\(\Gamma \sequent \varphi\)は導出可能である．
\end{proof}

\begin{Thm} \label[Thm]{Thm:DNFsequent}
	\(\varphi\)を論理式とするとき，シークエント\(\lnot \lnot \varphi \sequent \varphi\)と
	\(\varphi \sequent \lnot \lnot \varphi\)はいずれも導出可能である．
\end{Thm}

\begin{proof}
	シークエント\(\lnot \lnot \varphi \sequent \varphi\)は次のようにして得られる．
	\begin{prooftree}
		\AxiomC{}
		\LeftLabel{(ID)}
		\UnaryInfC{\(\lnot \lnot \varphi \sequent \lnot \lnot \varphi\)}
		\LeftLabel{(DNF)}
		\UnaryInfC{\(\lnot \lnot \varphi \sequent \varphi\)}
	\end{prooftree}
	次に，シークエント\(\varphi \sequent \lnot \lnot \varphi\)を導出する．
	\begin{prooftree}
		\AxiomC{}
		\LeftLabel{(ID)}
		\UnaryInfC{\(\lnot \varphi \sequent \lnot \varphi\)}
		\AxiomC{}
		\LeftLabel{(ID)}
		\UnaryInfC{\(\varphi \sequent \varphi\)}
		\LeftLabel{(\(\lnot\)E)}
		\BinaryInfC{\(\lnot \varphi, \varphi \sequent \bot\)}
		\LeftLabel{(\(\lnot\)I)}
		\UnaryInfC{\(\varphi \sequent \lnot \lnot \varphi\)}
	\end{prooftree}
	よって，シークエント\(\lnot \lnot \varphi \sequent \varphi\)と
	\(\varphi \sequent \lnot \lnot \varphi\)はいずれも導出可能である．
\end{proof}

シークエントの導出過程を示すとき，\cref{Thm:RAA}の証明のように各推論規則の適用過程を
上から下に進む木構造として書き下すのが普通である．
体系がもつ一般的な性質を研究する上ではこの記法は非常に便利なのだが，
個々のシークエントの導出を人間の目にわかりやすい形で行うには扱いずらい．
そこで，推論規則の適用過程は
導出可能であることが分かったシークエントを順に書き並べる形で示すこととする．
次の\cref{Thm:lawofexcludedmiddle}で実例を見せるとしよう．

\begin{Thm}[排中律] \label[Thm]{Thm:lawofexcludedmiddle}
	\(\varphi\)を論理式とするとき，論理式
	\begin{equation}
		\varphi \lor \lnot \varphi
	\end{equation}
	は証明可能である．
\end{Thm}

\begin{proof}
	シークエント\(\sequent \varphi \lor \lnot \varphi\)
	を以下のようにして導く．
	\begin{enumerate}
		\item \(\lnot \paren{\varphi \lor \lnot \varphi} \sequent \lnot \paren{\varphi \lor \lnot \varphi}\)\quad (ID)
		\item \(\varphi \sequent \varphi\)\quad (ID)
		\item \(\varphi \sequent \varphi \lor \lnot \varphi\)\quad （2から(\(\lor\)I)）
		\item \(\varphi, \lnot \paren{\varphi \lor \lnot \varphi} \sequent \bot\)\quad （3から(\(\lnot\)E)）
		\item \(\lnot \paren{\varphi \lor \lnot \varphi} \sequent \lnot \varphi\)\quad （4から(\(\lnot\)I)）
		\item \(\lnot \varphi \sequent \varphi \lor \lnot \varphi\)\quad （5から(\(\lor\)I)）
		\item \(\lnot \paren{\varphi \lor \lnot \varphi} \sequent \bot\)\quad （5,6から(\(\lnot\)E)）
		\item \(\sequent \lnot \lnot \paren{\varphi \lor \lnot \varphi}\)\quad （7から(\(\lnot\)I)）
		\item \(\sequent \varphi \lor \lnot \varphi\)\quad （8から(DNF)）
	\end{enumerate}
\end{proof}

\Cref{Thm:lawofexcludedmiddle}の証明で提示したシークエントの導出過程は，
通常の数学における次のような証明に対応していると考えることができる．

\begin{naiveproof}
	\(\lnot \paren{\varphi \lor \lnot \varphi}\)だと仮定して矛盾を導く．
	\(\varphi\)であるとすると\(\varphi \lor \lnot \varphi\)となり，
	\(\lnot \paren{\varphi \lor \lnot \varphi}\)と矛盾する．
	従って\(\lnot \varphi\)でなければならない．
	しかしこの場合も\(\varphi \lor \lnot \varphi\)となり
	\(\lnot \paren{\varphi \lor \lnot \varphi}\)と矛盾する．
	よって，\(\lnot \lnot \paren{\varphi \lor \lnot \varphi}\)，
	すなわち\(\varphi \lor \lnot \varphi\)となる．
\end{naiveproof}